<!DOCTYPE html>  <html lang="ar" dir="rtl">  
<head>  
  <meta charset="UTF-8" />  
  <title>أبو عبدو لخدمات الشحن</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <style>  
    :root{  
      --brand:#0d85ba;  
      --bg:#f7f9fc;  
      --card:#ffffff;  
      --text:#0a0a0a;  
      --muted:#6e7280;  
      --danger:#b91c1c;  
    }  
    *{box-sizing:border-box}  
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Tahoma,Arial;margin:0;  
      background:var(--bg);color:var(--text);}  
    .container{max-width:980px;margin:auto;padding:0 16px}  
    header{position:sticky;top:0;z-index:20;background:var(--brand);color:#fff;  
      border-bottom:2px solid #083a7a}  
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:10px 0}  /* اللوجو */  
.brand img{  
  height:70px;width:auto;  
  display:block;  
  background:#fff;  
  padding:8px 14px;  
  border-radius:14px;  
  box-shadow:0 2px 6px rgba(0,0,0,.2);  
}  

/* العنوان في الوسط */  
.nav h1{  
  flex:1;  
  text-align:center;  
  font-size:34px;  
  font-weight:900;  
  margin:0;  
  color:#fff; /* أبيض */  
  text-shadow:1px 1px 4px rgba(0,0,0,0.5);  
}  

/* الروابط */  
.links{display:flex;align-items:center;gap:12px;list-style:none;margin:0;padding:0}  
.links a{color:#fff;text-decoration:none;padding:8px 10px;border-radius:8px}  
.links a:hover{background:#084a96}  

/* زر واتساب */  
.links .wa-btn{  
  display:inline-flex;  
  align-items:center;  
  justify-content:center;  
  height:40px;  
  width:40px;  
  background:#25D366;  
  border-radius:999px;  
  box-shadow:0 2px 6px rgba(0,0,0,.2);  
  transition:transform .2s ease, box-shadow .2s ease;  
}  
.links .wa-btn:hover{  
  transform:scale(1.08);  
  box-shadow:0 4px 10px rgba(0,0,0,.25);  
}  
.links .wa-btn img{height:22px;width:22px;display:block}  

main{padding:20px 0}  
.card{background:var(--card);border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);  
  padding:18px;margin:14px 0}  
.form-group{margin:10px 0}  
label{display:block;font-weight:700;margin-bottom:6px}  
input,select,textarea{width:100%;padding:12px 14px;border:1px solid #d8dee9;  
  border-radius:10px;font-size:16px}  
button{background:var(--brand);color:#fff;border:none;cursor:pointer;padding:12px 20px;  
  border-radius:10px;font-size:16px}  
button.secondary{background:#e5e7eb;color:#111}  
.muted{color:var(--muted);font-size:14px}  
option[disabled]{color:gray}  
footer{padding:16px;background:#374151;color:#fff;text-align:center}  

/* إبراز الحقول الناقصة بالأحمر */  
input.error, select.error, textarea.error{  
  border-color: var(--danger) !important;  
  box-shadow: 0 0 0 2px rgba(185,28,28,.12);  
  outline: none;  
}

  </style>  
</head>  
<body>  
  <header>  
    <div class="container nav">  
      <div class="brand">  
        <img src="logo.png" alt="شعار أبو عبدو للشحن" />  
      </div>  <h1>أبو عبدو لخدمات الشحن</h1>  

  <ul class="links">  
    <li><a href="#">الرئيسية</a></li>  
    <li><a href="#step1">من 🚪 إلى 🚪</a></li>  
    <!-- جديد: رابط تتبع الشحنة -->
    <li><a href="#tracking">تتبع الشحنة</a></li>
    <li style="text-align:center">  
      <a class="wa-btn"  
         href="https://wa.me/966542354559"  
         target="_blank" rel="noopener"  
         aria-label="تواصل عبر واتساب">  
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="">  
      </a>  
      <div style="color:#fff;font-size:13px;margin-top:4px;">للتواصل واتساب</div>  
    </li>  
  </ul>  
</div>

  </header>    <main class="container">  
  <!-- الخطوة ١ -->  
  <section id="step1" class="card">  
    <h2>الخطوة ١ – بيانات الشحن</h2>  <div class="form-group">  
  <label for="saCity">مدينة الشحن (السعودية) <span class="req">*</span></label>  
  <select id="saCity" required>  
    <option value="">اختر</option>  
    <option>الرياض</option>  
    <option>جدة</option>  
    <option>مكة</option>  
    <option>المدينة</option>  
    <option>الدمام</option>  
    <option>الخبر</option>  
    <option>القصيم</option>  
    <option>أبها</option>  
  </select>  
</div>  

<div class="form-group">  
  <label for="sdState">الولاية (السودان) <span class="req">*</span></label>  
  <select id="sdState" required>  
    <option value="">اختر</option>  
    <option>ولاية الخرطوم</option>  
    <option>الولاية الشمالية</option>  
    <option>نهر النيل</option>  
    <option>البحر الأحمر</option>  
    <option>كسلا</option>  
    <option>القضارف</option>  
    <option>سنار</option>  
    <option>النيل الأزرق</option>  
    <option>النيل الأبيض</option>  
    <option>الجزيرة</option>  
    <option disabled>شمال كردفان — غير متاح</option>  
    <option disabled>جنوب كردفان — غير متاح</option>  
    <option disabled>غرب كردفان — غير متاح</option>  
    <option disabled>شمال دارفور — غير متاح</option>  
    <option disabled>جنوب دارفور — غير متاح</option>  
    <option disabled>غرب دارفور — غير متاح</option>  
    <option disabled>وسط دارفور — غير متاح</option>  
    <option disabled>شرق دارفور — غير متاح</option>  
  </select>  
  <p class="muted">⚠️ ولايات دارفور وكردفان غير متاحة حاليا.</p>  
</div>  

<div class="form-group">  
  <label for="area">اسم المنطقة <span class="req">*</span></label>  
  <input id="area" placeholder="مثال: بحري — الحلفايا" required />  
</div>  

<!-- نوع الشحن -->  
<div class="form-group">  
  <label for="shipSpeed">نوع الشحن <span class="req">*</span></label>  
  <select id="shipSpeed" required>  
    <option>شحن عادي</option>  
    <option>شحن سريع</option>  
  </select>  
</div>  

<!-- بيانات المرسل أولاً -->  
<h3>👤 بيانات المرسل</h3>  
<div class="row">  
  <div class="form-group">  
    <label for="senderName">اسم المرسل <span class="req">*</span></label>  
    <input id="senderName" placeholder="مثال: أحمد علي" required />  
  </div>  
  <div class="form-group">  
    <label for="phone">رقم جوال المرسل (السعودية) <span class="req">*</span></label>  
    <input id="phone" placeholder="05xxxxxxxx" required />  
  </div>  
</div>  
<div class="row">  
  <div class="form-group"><label for="senderNeighborhood">الحي <span class="req">*</span></label><input id="senderNeighborhood" placeholder="مثال: النسيم" required /></div>  
  <div class="form-group"><label for="senderStreet">الشارع <span class="req">*</span></label><input id="senderStreet" placeholder="مثال: شارع حسان بن ثابت" required /></div>  
</div>  
<div class="form-group"><label for="senderLandmark">معلم بارز <span class="req">*</span></label><input id="senderLandmark" placeholder="مثال: جوار مسجد الهدى" required /></div>  

<!-- بيانات المستلم ثانيًا -->  
<h3>👤 بيانات المستلم</h3>  
<div class="row">  
  <div class="form-group"><label for="receiverName">اسم المستلم <span class="req">*</span></label><input id="receiverName" required /></div>  
  <div class="form-group"><label for="receiverPhone">رقم المستلم (السودان) <span class="req">*</span></label><input id="receiverPhone" required /></div>  
</div>  

<div style="margin-top:12px">  
  <button id="toStep2">التالي</button>  
</div>

  </section>    <!-- الخطوة ٢ -->    <section id="step2" class="card" style="display:none">  
    <h2>الخطوة ٢ – إضافة الشحنات</h2>  <div class="form-group">  
  <label for="item">نوع الشحنة <span class="req">*</span></label>  
  <select id="item" required>  
    <option value="">اختر</option>  

    <!-- طرود عامة -->  
    <optgroup label="طرود عامة">  
      <option>برميل مواد غذائية</option>  
      <option>كرتون صغير</option>  
      <option>كرتون متوسط</option>  
      <option>كرتون كبير</option>  
      <option>شنطة سفر صغيرة</option>  
      <option>شنطة سفر كبيرة</option>  
      <option>حقيبة ملابس</option>  
      <option>ملابس</option>  
      <option>أحذية</option>  
      <option>أدوات مطبخ</option>  
      <option>مواد غذائية متنوعة</option>  
      <option>تمور/مواد غذائية</option>  
      <option>ألعاب أطفال</option>  
      <option>كتب/مطبوعات</option>  
      <option>أدوات مكتبية</option>  
      <option>مستحضرات تجميل</option>  
      <option>معدات/عدد يدوية</option>  
      <option>قطع غيار خفيفة</option>  
      <option>إطارات</option>  
      <option>جنوط</option>  
      <option>مواد أخرى</option>  
      <option>أخرى (طرد/علبة/حقيبة)</option>  
    </optgroup>  

    <!-- أجهزة كهربائية (المقاس/البوصة إجباري) -->  
    <optgroup label="أجهزة كهربائية (المقاس/البوصة إجباري)">  
      <option>ثلاجة صغيرة</option>  
      <option>ثلاجة متوسطة</option>  
      <option>ثلاجة كبيرة</option>  
      <option>فريزر أفقي</option>  
      <option>فريزر رأسي</option>  
      <option>غسالة ملابس</option>  
      <option>نشاف/مجفف ملابس</option>  
      <option>غسالة صحون</option>  
      <option>مكيف شباك</option>  
      <option>مكيف سبليت</option>  
      <option>ميكروويف</option>  
      <option>فرن كهربائي</option>  
      <option>دفاية/سخان ماء</option>  
      <option>سخان مركّب</option>  
      <option>مكنسة كهربائية</option>  
      <option>خلاط/محضّر طعام</option>  
      <option>عصارة</option>  
      <option>محمصة خبز</option>  
      <option>قدر ضغط كهربائي</option>  
      <option>ماكينة قهوة</option>  
      <option>ماكينة ثلج/مبرد ماء</option>  
      <option>تلفزيون 32 بوصة</option>  
      <option>تلفزيون 43 بوصة</option>  
      <option>تلفزيون 50 بوصة</option>  
      <option>تلفزيون 55 بوصة</option>  
      <option>تلفزيون 65 بوصة</option>  
      <option>تلفزيون 75 بوصة</option>  
      <option>شاشة كمبيوتر</option>  
      <option>كمبيوتر مكتبي</option>  
      <option>لابتوب</option>  
      <option>طابعة</option>  
      <option>راوتر/مودم</option>  
      <option>سماعات كبيرة</option>  
      <option>جهاز صوت منزلي</option>  
      <option>مشغل أقراص/رسيفر</option>  
      <option>مكنة خياطة (كهربائية)</option>  
      <option>سكوتر كهربائي</option>  
      <option>أجهزة كهربائية أخرى</option>  
    </optgroup>  

    <!-- أثاث ومقتنيات -->  
    <optgroup label="أثاث ومقتنيات">  
      <option>دولاب ملابس</option>  
      <option>سرير منفرد</option>  
      <option>سرير مزدوج</option>  
      <option>مرتبة مفرد</option>  
      <option>مرتبة مزدوج</option>  
      <option>كنبة/أريكة</option>  
      <option>طقم جلوس</option>  
      <option>طاولة طعام</option>  
      <option>طاولات صغيرة</option>  
      <option>كراسي</option>  
      <option>مكتب</option>  
      <option>مكتبة/رفوف</option>  
      <option>كومودينو</option>  
      <option>مرآة كبيرة</option>  
      <option>سجادة</option>  
      <option>أثاث متنوع</option>  
    </optgroup>  

    <!-- أصناف أخرى -->  
    <optgroup label="أصناف أخرى">  
      <option>دراجة/سيكل</option>  
      <option>سكوتر بدون محرك</option>  
      <option>معدات رياضية</option>  
      <option>آلات موسيقية غير كهربائية</option>  
      <option>مواد أخرى</option>  
    </optgroup>  
  </select>  
  <small class="muted">* الوزن والحجم إلزاميان لكل الشحنات — والمقاس/البوصة يظهر ويصبح إلزاميًا فقط للأجهزة الكهربائية.</small>  
</div>  

<div class="row">  
  <div class="form-group">  
    <label for="weight">الوزن (كجم) <span class="req">*</span></label>  
    <input type="number" id="weight" min="1" placeholder="مثال: 25" required />  
  </div>  
  <div class="form-group">  
    <label for="sizeSelect">الحجم <span class="req">*</span></label>  
    <select id="sizeSelect" required>  
      <option value="">اختر</option>  
      <option>صغير</option>  
      <option>وسط</option>  
      <option>كبير</option>  
    </select>  
  </div>  
</div>  

<!-- المقاس/البوصة للأجهزة الكهربائية فقط -->  
<div class="form-group" id="dimGroup" style="display:none">  
  <label for="dimensions">المقاس/البوصة <span class="req">*</span></label>  
  <input id="dimensions" placeholder="مثال: 55 بوصة أو 60x40x40 سم" />  
</div>  

<div style="margin-top:8px"><button id="addToCart">إضافة للسلة</button></div>  

<h3>السلة</h3>  
<ul id="cartList"></ul>  

<div style="margin-top:12px;display:flex;gap:10px">  
  <button class="secondary" id="back1">رجوع</button>  
  <button id="checkout">إرسال عبر واتساب</button>  
</div>  
<p class="muted">⚠️ لا توجد أسعار في الموقع — سيتم تسعير الطلب يدويًا عبر واتساب (الدفع عند الاستلام).</p>

  </section>  

  <!-- جديد: قسم تتبع الشحنة -->
  <section id="tracking" class="card">
    <h2>🔎 تتبّع الشحنة</h2>
    <div class="form-group" style="margin-top:6px">
      <input id="trackId" placeholder="مثال: ABD-001" autofocus />
    </div>
    <button id="trackBtn">تتبّع الآن</button>
    <p id="trackResult" class="muted" style="margin-top:10px"></p>
  </section>

  </main>  <footer> أبو عبدو للشحن — من بيتك لبيت أهلك ... شحن مضمون مع أبو عبدو</footer>  <script>  
  /* الأجهزة الكهربائية لتفعيل خانة المقاس/البوصة */  
  const ELECTRONICS = new Set([  
    "ثلاجة صغيرة","ثلاجة متوسطة","ثلاجة كبيرة",  
    "فريزر أفقي","فريزر رأسي",  
    "غسالة ملابس","نشاف/مجفف ملابس","غسالة صحون",  
    "مكيف شباك","مكيف سبليت",  
    "ميكروويف","فرن كهربائي",  
    "دفاية/سخان ماء","سخان مركّب",  
    "مكنسة كهربائية",  
    "خلاط/محضّر طعام","عصارة","محمصة خبز","قدر ضغط كهربائي","ماكينة قهوة","ماكينة ثلج/مبرد ماء",  
    "تلفزيون 32 بوصة","تلفزيون 43 بوصة","تلفزيون 50 بوصة","تلفزيون 55 بوصة","تلفزيون 65 بوصة","تلفزيون 75 بوصة",  
    "شاشة كمبيوتر","كمبيوتر مكتبي","لابتوب","طابعة","راوتر/مودم",  
    "سماعات كبيرة","جهاز صوت منزلي","مشغل أقراص/رسيفر",  
    "مكنة خياطة (كهربائية)","سكوتر كهربائي",  
    "أجهزة كهربائية أخرى"  
  ]);  
  
  /* عناصر DOM */  
  const step1=document.getElementById("step1");  
  const step2=document.getElementById("step2");  
  const toStep2Btn=document.getElementById("toStep2");  
  const back1Btn=document.getElementById("back1");  
  const addToCartBtn=document.getElementById("addToCart");  
  const checkoutBtn=document.getElementById("checkout");  
  const cartList=document.getElementById("cartList");  
  
  const itemSel=document.getElementById("item");  
  const weightIn=document.getElementById("weight");  
  const sizeSel=document.getElementById("sizeSelect");  
  const dimGroup=document.getElementById("dimGroup");  
  const dimIn=document.getElementById("dimensions");  
  
  /* أدوات تمييز/إزالة الأحمر للحقول */  
  function markError(el, hasError){  
    if(!el) return;  
    if(hasError){ el.classList.add('error'); }  
    else{ el.classList.remove('error'); }  
  }  
  function clearOnInput(el){  
    if(!el) return;  
    const ev = (el.tagName === 'SELECT') ? 'change' : 'input';  
    el.addEventListener(ev, ()=> markError(el, false));  
  }  
  
  /* إظهار/إخفاء المقاس للأجهزة الكهربائية */  
  function toggleDim(){  
    if(ELECTRONICS.has(itemSel.value)){  
      dimGroup.style.display='block';  
      dimIn.setAttribute('required','required');  
    }else{  
      dimGroup.style.display='none';  
      dimIn.removeAttribute('required');  
      dimIn.value='';  
      markError(dimIn,false);  
    }  
  }  
  itemSel.addEventListener('change', toggleDim);  
  toggleDim();  
  
  /* تجهيز مستمعات إزالة الأحمر */  
  [  
    'saCity','sdState','area','shipSpeed',  
    'senderName','phone','senderNeighborhood','senderStreet','senderLandmark',  
    'receiverName','receiverPhone',  
    'item','weight','sizeSelect','dimensions'  
  ].forEach(id => clearOnInput(document.getElementById(id)));  
  
  /* تحقق خطوة 1 مع تلوين الناقص */  
  function validateStep1WithHighlight(){  
    const saCity=document.getElementById('saCity');  
    const sdState=document.getElementById('sdState');  
    const area=document.getElementById('area');  
    const shipSpeed=document.getElementById('shipSpeed');  
    const senderName=document.getElementById('senderName');  
    const phone=document.getElementById('phone');  
    const senderNeighborhood=document.getElementById('senderNeighborhood');  
    const senderStreet=document.getElementById('senderStreet');  
    const senderLandmark=document.getElementById('senderLandmark');  
    const receiverName=document.getElementById('receiverName');  
    const receiverPhone=document.getElementById('receiverPhone');  
  
    let ok = true;  
  
    [[saCity, !!saCity.value.trim()],  
     [sdState, !!sdState.value.trim()],  
     [area, !!area.value.trim()],  
     [shipSpeed, !!shipSpeed.value.trim()],  
     [senderName, !!senderName.value.trim()],  
     [phone, /^0?5\d{8}$/.test((phone.value||'').trim())],  
     [senderNeighborhood, !!senderNeighborhood.value.trim()],  
     [senderStreet, !!senderStreet.value.trim()],  
     [senderLandmark, !!senderLandmark.value.trim()],  
     [receiverName, !!receiverName.value.trim()],  
     [receiverPhone, !!receiverPhone.value.trim()]  
    ].forEach(([el, valid])=>{  
      if(!valid){ ok=false; markError(el,true); } else { markError(el,false); }  
    });  
  
    return ok;  
  }  
  
  /* زر التالي */  
  toStep2Btn.addEventListener('click', ()=>{  
    if(!validateStep1WithHighlight()){  
      alert("يرجى تعبئة الحقول الإجبارية المظللة باللون الأحمر.");  
      return;  
    }  
    step1.style.display='none';  
    step2.style.display='block';  
  });  
  
  back1Btn.addEventListener('click', ()=>{  
    step2.style.display='none';  
    step1.style.display='block';  
  });  
  
  /* السلة */  
  let cart=[];  
  function renderCart(){  
    cartList.innerHTML = cart.length  
      ? cart.map((c,i)=>`<li>${i+1}) ${c.item} — ${c.size} — ${c.weight}كجم${c.dim? ' — '+c.dim:''}</li>`).join('')  
      : '<li class="muted">السلة فارغة.</li>';  
  }  
  
  /* إضافة للسلة مع إبراز الناقص */  
  addToCartBtn.addEventListener('click', ()=>{  
    const item=(itemSel.value||'').trim();  
    const weight=(weightIn.value||'').trim();  
    const size=(sizeSel.value||'').trim();  
    const isElec = ELECTRONICS.has(itemSel.value);  
    const dim = isElec ? (dimIn.value||'').trim() : '';  
  
    let ok = true;  
    [[itemSel, !!item],[weightIn, !!weight],[sizeSel, !!size]].forEach(([el,valid])=>{  
      if(!valid){ ok=false; markError(el,true); } else { markError(el,false); }  
    });  
    if(isElec && !dim){  
      ok=false; markError(dimIn,true);  
    } else {  
      markError(dimIn,false);  
    }  
  
    if(!ok){  
      alert("يرجى إدخال نوع الشحنة، الوزن، الحجم، والمقاس/البوصة للأجهزة (المظللة بالأحمر).");  
      return;  
    }  
  
    cart.push({item,weight,size,dim});  
    renderCart();  
    itemSel.value=''; weightIn.value=''; sizeSel.value=''; dimIn.value='';  
    toggleDim();  
  });  
  
  /* إرسال الواتساب بكل التفاصيل مع إبراز الناقص */  
  checkoutBtn.addEventListener('click', ()=>{  
    if(cart.length===0){  
      alert('أضف شحنة واحدة على الأقل');  
      return;  
    }  
  
    const ok = validateStep1WithHighlight();  
    if(!ok){  
      alert('يرجى تعبئة جميع حقول الخطوة ١ (المظللة بالأحمر) قبل الإرسال.');  
      step2.style.display='none'; step1.style.display='block';  
      return;  
    }  
  
    const saCity=(document.getElementById('saCity').value||'').trim();  
    const sdState=(document.getElementById('sdState').value||'').trim();  
    const area=(document.getElementById('area').value||'').trim();  
    const shipSpeed=(document.getElementById('shipSpeed').value||'').trim();  
  
    const senderName=(document.getElementById('senderName').value||'').trim();  
    const phone=(document.getElementById('phone').value||'').trim();  
    const senderNeighborhood=(document.getElementById('senderNeighborhood').value||'').trim();  
    const senderStreet=(document.getElementById('senderStreet').value||'').trim();  
    const senderLandmark=(document.getElementById('senderLandmark').value||'').trim();  
  
    const receiverName=(document.getElementById('receiverName').value||'').trim();  
    const receiverPhone=(document.getElementById('receiverPhone').value||'').trim();  
  
    const orderId = 'ABD-' + Math.random().toString(36).slice(2,8).toUpperCase();  
    const cartLines = cart.map((c,i)=>`${i+1}) ${c.item} — ${c.size} — ${c.weight}كجم${c.dim? ' — '+c.dim:''}`).join('%0A');  
  
    const msg =  
      `طلب شحن جديد (${orderId})%0A` +  
      `%0A🚚 *بيانات الشحن*%0Aمدينة الشحن: ${saCity}%0Aولاية الاستلام: ${sdState}%0Aالمنطقة: ${area}%0Aنوع الشحن: ${shipSpeed}%0A` +  
      `%0A👤 *بيانات المرسل*%0Aالاسم: ${senderName}%0Aالجوال: ${phone}%0Aالحي: ${senderNeighborhood}%0Aالشارع: ${senderStreet}%0Aمعلم بارز: ${senderLandmark}%0A` +  
      `%0A👤 *بيانات المستلم*%0Aالاسم: ${receiverName}%0Aالجوال: ${receiverPhone}%0A` +  
      `%0A📦 *الشحنات*:%0A${cartLines}%0A` +  
      `%0A💰 الدفع عند الاستلام`;  
  
    const whatsappNumber = "966542354559"; // رقمك بصيغة دولية بدون +  
    const url = `https://wa.me/${whatsappNumber}?text=${msg}`;  
    window.location.href = url;  
  });  
</script>

<!-- جديد: سكربت تتبع الشحنة (قراءة Google Sheets) -->
<script>
  (function(){
    const SHEET_ID = '1pNsciARaC0dWVA_bYsxoiMkFfts3u5gpNcRVae-lWqQ';
    const SHEET_NAME = 'Sheet1';

    const trackBtn = document.getElementById('trackBtn');
    const trackInput = document.getElementById('trackId');
    const trackResult = document.getElementById('trackResult');

    async function fetchRows(){
      const tq = encodeURIComponent('select A,B,C'); // A=رقم التتبّع, B=الحالة, C=التاريخ
      const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&tq=${tq}`;
      const res = await fetch(url, { mode: 'cors' });
      if(!res.ok) throw new Error('HTTP ' + res.status);
      const text = await res.text();
      const jsonText = (text.match(/\{[\s\S]*\}/) || ['{}'])[0];
      const data = JSON.parse(jsonText);
      return (data.table && data.table.rows) ? data.table.rows : [];
    }

    function cellVal(cell){
      if(!cell) return '';
      return (cell.f != null ? cell.f : cell.v) ?? '';
    }

    async function checkTracking(){
      const id = (trackInput.value || '').trim();
      if(!id){
        trackResult.textContent = '⚠️ أدخل رقم التتبّع أولاً';
        return;
      }
      trackResult.textContent = '⏳ جارٍ البحث...';
      try{
        const rows = await fetchRows();
        const hit = rows.find(r => cellVal(r.c[0]) === id);
        if(hit){
          const status = cellVal(hit.c[1]);
          const date   = cellVal(hit.c[2]);
          trackResult.textContent = `📦 الحالة: ${status} — 📅 التاريخ: ${date}`;
        }else{
          trackResult.textContent = '❌ لم يتم العثور على رقم التتبّع.';
        }
      }catch(e){
        console.error('Tracking fetch error:', e);
        trackResult.textContent = '⚠️ تعذّر الاتصال بقاعدة البيانات. تأكّد من جعل Google Sheet على Anyone with the link (Viewer) واسم الورقة Sheet1.';
      }
    }

    if(trackBtn){ trackBtn.addEventListener('click', checkTracking); }
  })();
</script>

</body>  
</html>
```0
